---
# Variables for sybase_inspec role

# Supported Sybase versions
supported_sybase_versions:
  - "15"
  - "16"

# InSpec binary path
inspec_binary_path: "/usr/bin/inspec"

# Control file patterns
control_file_pattern: "*.rb"

# Result file format
result_format: "json-min"

# Environment variables matching original NIST.ksh script
# Sybase-specific environment setup with SSH support
sybase_environment:
  PATH: "/usr/local/oracle/NIST_FILES/mssql-tools/bin:/tools/ver/sybase/OCS-16_0/bin:{{ ansible_env.PATH }}"
  LD_LIBRARY_PATH: "/tools/ver/oracle-19.16.0.0-64:/tools/ver/sybase/OCS-16_0/lib:{{ ansible_env.LD_LIBRARY_PATH | default('') }}"
  SYBASE: "/tools/ver/sybase"
  SYBASE_OCS: "OCS-16_0"
  INSPEC_BACKEND: "sybase"
  SSH_AUTH_SOCK: "{{ ansible_env.SSH_AUTH_SOCK | default('') }}"

# Timestamp formats matching original script exactly
timestamp_format: "%Y_%m%d_%H%M%S"
touch_time_format: "%Y%m%d%H%M.%S"
splunk_time_format: "%Y-%m-%d %H:%M:%S"

# File naming patterns matching original script
# Original: ${platform}_NIST_$$_${servernm}_${dbname}_${dbversion}_${now}_${file_prefix}.json
file_name_template: "SYBASE_NIST_{{ ansible_process_id }}_{{ sybase_server }}_{{ sybase_database }}_{{ sybase_version }}_{{ timestamp }}"
temp_dir_template: "SYBASE_NIST_{{ ansible_process_id }}_{{ timestamp }}_temp_files"

# Directory structure matching original script
# From NIST_for_db.ksh: ruby_dir=$script_dir/${platform}_${dbversion}_ruby
controls_dir_pattern: "SYBASE{{ sybase_version }}_ruby"
log_dir_pattern: "SYBASENIST"

# Process execution settings
parallelism: 3
max_parallelism: 12

# SSH configuration for Sybase (unique feature)
# From NIST_for_db.ksh: --ssh://oracle:edcp!cv0576@ -o oracle/.ssh/authorized_keys
ssh_settings:
  enabled: true
  default_user: "oracle"
  default_keyfile: "oracle/.ssh/authorized_keys"
  connection_timeout: 30
  command_timeout: 300
  
# Sybase connection settings
sybase_settings:
  default_charset: "utf8"
  packet_size: 4096
  login_timeout: 30
  query_timeout: 300

# Error messages
error_messages:
  missing_params: "Required Sybase connection parameters are missing"
  inspec_not_installed: "InSpec is not installed. Please install InSpec before running this role."
  unsupported_version: "Sybase version is not supported"
  connection_failed: "Cannot connect to database. Please verify connection parameters."
  password_retrieval_failed: "Unable to retrieve password from secure store"
  ruby_dir_missing: "The directory specified as ruby_dir for Database Platform SYBASE in the script does not exist or the permissions to access the directory are insufficient."
  ssh_connection_failed: "SSH connection to Sybase server failed. Please verify SSH credentials and connectivity."
  sybase_client_missing: "Sybase client tools not found. Please install Sybase ASE client."

# JSON error templates matching original script exactly
json_templates:
  connection_error: |
    {"controls":[{"timestamp":"","hostname":"{{ sybase_server }}","database":"{{ sybase_database }}","port":"{{ sybase_port }}","DBVersion":"{{ sybase_version }}","id":"Cannot connect to database. One or more parameters such as Platform, Host Name, Database Name, Service Name, Port Number, Database Version may be incorrect.","profile_id":"N/A","profile_sha256":"N/A","status":"Unreachable","code_desc":"Cannot connect","statistics":{"duration":0},"version":"N/A"}]}
  cloakware_unreachable: |
    {"controls":[{"timestamp":"","hostname":"{{ sybase_server }}","database":"{{ sybase_database }}","port":"{{ sybase_port }}","DBVersion":"{{ sybase_version }}","id":"Not able to retrieve Cloakware Password for DBMAINT Account","profile_id":"N/A","profile_sha256":"N/A","status":"Unreachable","code_desc":"N/A","statistics":{"duration":0},"version":"N/A"}]}
  ssh_error: |
    {"controls":[{"timestamp":"","hostname":"{{ sybase_server }}","database":"{{ sybase_database }}","port":"{{ sybase_port }}","DBVersion":"{{ sybase_version }}","id":"SSH connection failed for Sybase database access","profile_id":"N/A","profile_sha256":"N/A","status":"Unreachable","code_desc":"SSH connection failed","statistics":{"duration":0},"version":"N/A"}]}

# InSpec execution settings
inspec_settings:
  reporter: "json-min"
  no_color: true
  backend: "sybase"
  timeout: 300

# SSH command patterns matching original script
# From NIST_for_db.ksh: /usr/bin/inspec exec ... --ssh://oracle:edcp!cv0576@ -o oracle/.ssh/authorized_keys
ssh_command_patterns:
  inspec_ssh_template: "--ssh://{{ sybase_ssh_user }}:{{ vault_sybase_ssh_password }}@{{ sybase_server }} -o {{ sybase_ssh_keyfile }}"
  ssh_options:
    - "StrictHostKeyChecking=no"
    - "UserKnownHostsFile=/dev/null"
    - "ConnectTimeout=30"
    - "ServerAliveInterval=60"
